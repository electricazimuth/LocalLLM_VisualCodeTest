<!DOCTYPE html>
<html>
<head>
    <title>Fireworks Simulation</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #111; } /* Dark background suggested */
        canvas { border: 1px solid #444; background-color: #000; display: block; margin: 20px auto; } /* Dark canvas bg */
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const W = canvas.width;
        const H = canvas.height;

        // --- Particle Classes ---

        class Particle {
            constructor(x, y, vx, vy, color, size, lifespan) {
                this.x = x;
                this.y = y;
                this.vx = vx;
                this.vy = vy;
                this.color = color;
                this.size = size;
                this.lifespan = lifespan;
                this.maxLifespan = lifespan;
            }

            update(deltaTime) {
                // Apply gravity
                this.vy += 0.5; // Gravity constant

                // Update position
                this.x += this.vx * deltaTime;
                this.y += this.vy * deltaTime;

                // Decrease lifespan
                this.lifespan -= deltaTime;

                // Return true if alive
                return this.lifespan > 0;
            }

            draw() {
                const alpha = this.lifespan / this.maxLifespan;
                ctx.save();
                ctx.globalAlpha = alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        class Rocket extends Particle {
            constructor(x, y, color) {
                super(x, y, 
                      (Math.random() - 0.5) * 4, // Random horizontal velocity
                      -10, // Initial upward velocity (negative)
                      color, 
                      2, 
                      2000); // Lifespan in milliseconds

                this.fuseTime = 1000 + Math.random() * 1000; // 1-2 seconds
                this.timeAlive = 0;
                this.exploded = false;
            }

            update(deltaTime) {
                if (this.exploded) return false;

                this.timeAlive += deltaTime;
                this.vy += 0.5; // Gravity pulls down

                // Update position
                this.x += this.vx * deltaTime;
                this.y += this.vy * deltaTime;

                // Check if fuse is done or reached explosion height
                if (this.timeAlive >= this.fuseTime || this.y < H * 0.3) {
                    this.explode();
                    return false;
                }

                // Check if rocket is off-screen
                if (this.y > H) {
                    return false;
                }

                return true;
            }

            explode() {
                this.exploded = true;
                const explosionCount = 30 + Math.floor(Math.random() * 50);
                const explosionRadius = 0.25 * Math.min(W, H); // 25% of smallest dimension
                const explosionColor = this.color;

                // Create explosion particles
                for (let i = 0; i < explosionCount; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 2 + Math.random() * 8;
                    const vx = Math.cos(angle) * speed;
                    const vy = Math.sin(angle) * speed;

                    // Random color variation
                    const hue = (parseInt(explosionColor.slice(1, 3), 16) + (Math.random() - 0.5) * 100) % 256;
                    const saturation = (parseInt(explosionColor.slice(3, 5), 16) + (Math.random() - 0.5) * 100) % 256;
                    const lightness = (parseInt(explosionColor.slice(5, 7), 16) + (Math.random() - 0.5) * 100) % 256;
                    const color = `hsl(${hue}, ${saturation}%, ${lightness}%)`;

                    const particle = new ExplosionParticle(
                        this.x, 
                        this.y, 
                        vx, 
                        vy, 
                        color, 
                        2 + Math.random() * 2,
                        1500 + Math.random() * 1500
                    );
                    particles.push(particle);
                }
            }

            draw() {
                if (this.exploded) return;
                ctx.save();
                ctx.globalAlpha = 0.8;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        class ExplosionParticle extends Particle {
            constructor(x, y, vx, vy, color, size, lifespan) {
                super(x, y, vx, vy, color, size, lifespan);
            }

            update(deltaTime) {
                // Apply gravity
                this.vy += 0.5;

                // Update position
                this.x += this.vx * deltaTime;
                this.y += this.vy * deltaTime;

                // Decrease lifespan
                this.lifespan -= deltaTime;

                // Return true if alive
                return this.lifespan > 0;
            }

            draw() {
                const alpha = this.lifespan / this.maxLifespan;
                ctx.save();
                ctx.globalAlpha = alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        // --- Main Simulation State ---

        const particles = [];
        let lastRocketLaunch = 0;
        const rocketLaunchInterval = 500 + Math.random() * 1500; // 0.5 - 2 seconds

        // --- Utility Functions ---

        function getRandomColor() {
            const hue = Math.floor(Math.random() * 360);
            const saturation = 70 + Math.floor(Math.random() * 30);
            const lightness = 50 + Math.floor(Math.random() * 30);
            return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
        }

        function isOutOfBounds(particle) {
            return particle.y > H + 20 || particle.x < -20 || particle.x > W + 20;
        }

        // --- Game Loop ---

        function gameLoop(timestamp) {
            // Calculate delta time in seconds
            const deltaTime = (timestamp - lastTimestamp) / 1000;
            lastTimestamp = timestamp;

            // Clear canvas
            ctx.clearRect(0, 0, W, H);

            // --- Update Logic ---

            // Launch new rocket if needed
            if (timestamp - lastRocketLaunch >= rocketLaunchInterval) {
                const rocket = new Rocket(
                    W / 2 + (Math.random() - 0.5) * 100, // Random horizontal offset
                    H,
                    getRandomColor()
                );
                particles.push(rocket);
                lastRocketLaunch = timestamp;
                // Reset launch interval
                rocketLaunchInterval = 500 + Math.random() * 1500;
            }

            // Update all particles
            for (let i = particles.length - 1; i >= 0; i--) {
                const particle = particles[i];
                const isAlive = particle.update(deltaTime);

                // Remove if dead or off-screen
                if (!isAlive || isOutOfBounds(particle)) {
                    particles.splice(i, 1);
                }
            }

            // --- Draw Logic ---

            // Draw all particles
            for (const particle of particles) {
                particle.draw();
            }

            // Continue loop
            requestAnimationFrame(gameLoop);
        }

        // --- Initialization ---

        let lastTimestamp = 0;
        requestAnimationFrame(gameLoop);

        // Add any initial setup or event listeners here

    </script>
    <section id="notes">
        <h3>Implementation Notes</h3>
        <ul>
            <li><strong>Object-Oriented Design:</strong> Used inheritance with a base Particle class and specialized Rocket and ExplosionParticle classes for clear separation of concerns.</li>
            <li><strong>Efficient Array Management:</strong> Used a for loop with backwards iteration and splice() for safe removal of particles during updates.</li>
            <li><strong>Delta Time:</strong> Implemented proper delta time calculation for frame-rate independent animation.</li>
            <li><strong>Autonomous Launching:</strong> Rockets are launched at random intervals (0.5-2 seconds) with slight horizontal variation.</li>
            <li><strong>Realistic Physics:</strong> Gravity affects all particles, explosion particles have random initial velocities and realistic falling arcs.</li>
            <li><strong>Visual Fading:</strong> Explosion particles fade out based on their remaining lifespan using alpha blending.</li>
            <li><strong>Performance:</strong> The simulation handles hundreds of particles efficiently through optimized loops and minimal DOM manipulation.</li>
            <li><strong>Proportional Scaling:</strong> Fireworks travel at least half the canvas height and explosions are 20-30% of canvas dimensions.</li>
            <li><strong>Color Variety:</strong> Randomized colors with HSL for natural-looking fireworks with subtle variations.</li>
        </ul>
    </section>
</body>
</html>