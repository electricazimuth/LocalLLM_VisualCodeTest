<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Collision Simulation</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        canvas {
            display: block;
            margin: 20px auto;
            border: 1px solid #666;
            background-color: #000;
        }
    </style>
</head>
<body>
    <canvas id="simulationCanvas" width="512" height="512"></canvas>

    <script>
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        const numVehicles = 8; // Number of vehicles in the simulation
        const particleCount = 20; // Number of explosion particles

        let simulationState = 'RUNNING';
        let vehicles = [];
        let explosionParticles = [];
        let time = 0;

        const tileSize = 32; // Size of each vehicle tile
        const explosionRadius = 64;
        const explosionForce = 50; // Strength of explosion force
        const explosionDuration = 3; // Duration of explosion in seconds

        function Vehicle(x, y, vx, vy, color) {
            this.x = x;
            this.y = y;
            this.vx = vx;
            this.vy = vy;
            this.width = tileSize;
            this.height = tileSize;
            this.color = color;
            this.isActive = true;
        }

        function ExplosionParticle(x, y, vx, vy, lifespan, color) {
            this.x = x;
            this.y = y;
            this.vx = vx;
            this.vy = vy;
            this.lifespan = lifespan;
            this.color = color;
            this.size = Math.random(5) + 2;
        }

        function initializeVehicles() {
            for (let i = 0; i < numVehicles; i++) {
                const x = Math.random() * (canvas.width - tileSize);
                const y = Math.random() * (canvas.height - tileSize);
                const vx = (Math.random() - 0.5) * 2;
                const vy = (Math.random() - 0.5) * 2;
                const color = `hsl(${Math.random() * 360}, 100%, 50%)`;
                vehicles.push(new Vehicle(x, y, vx, vy, color));
            }
        }

        function handleCollision(vehicle1, vehicle2) {
            if (!vehicle1.isActive || !vehicle2.isActive) return;

            const dx = vehicle2.x - vehicle1.x;
            const dy = vehicle2.y - vehicle1.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < vehicle1.width + vehicle2.width) {
                // Collision detected!
                vehicle1.isActive = false;
                vehicle2.isActive = false;

                // Calculate collision point
                const collisionX = (vehicle1.x + vehicle2.x) / 2;
                const collisionY = (vehicle1.y + vehicle2.y) / 2;

                // Create explosion particles
                for (let i = 0; i < particleCount; i++) {
                    const angle = Math.random() * 2 * Math.PI;
                    const speed = Math.random() * explosionForce;
                    explosionParticles.push(new ExplosionParticle(collisionX, collisionY, speed * Math.cos(angle), speed * Math.sin(angle), explosionDuration, 'rgba(255, 0, 0, 0.8)'));
                }

                // Indicate explosion state
                simulationState = 'EXPLODING';
                time = 0;
            }
        }

        function updateVehicles() {
            for (const vehicle of vehicles) {
                if (!vehicle.isActive) continue;

                vehicle.x += vehicle.vx;
                vehicle.y += vehicle.vy;

                // Wrap around
                if (vehicle.x < 0) vehicle.x = canvas.width;
                if (vehicle.x > canvas.width) vehicle.x = 0;
                if (vehicle.y < 0) vehicle.y = canvas.height;
                if (vehicle.y > canvas.height) vehicle.y = 0;
            }
        }

        function updateExplosionParticles() {
            for (const particle of explosionParticles) {
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.lifespan--;

                if (particle.lifespan <= 0) {
                    explosionParticles = explosionParticles.filter(p => p.lifespan > 0);
                }

                if (particle.x < 0 || particle.x > canvas.width || particle.y < 0 || particle.y > canvas.height) {
                    explosionParticles = explosionParticles.filter(p => p.lifespan > 0);
                }
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (const vehicle of vehicles) {
                if (vehicle.isActive) {
                    ctx.fillStyle = vehicle.color;
                    ctx.fillRect(vehicle.x, vehicle.y, vehicle.width, vehicle.height);
                }
            }

            for (const particle of explosionParticles) {
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, 2 * Math.PI);
                ctx.fillStyle = particle.color;
                ctx.fill();
            }
        }

        function restartSimulation() {
            simulationState = 'RUNNING';
            initializeVehicles();
            explosionParticles = [];
            time = 0;
        }

        function animate() {
            requestAnimationFrame(animate);

            time += 0.016; // Delta time

            updateVehicles();
            updateExplosionParticles();

            if (simulationState === 'EXPLODING') {
                if (time >= explosionDuration) {
                    simulationState = 'RESTARTING';
                    time = 0;
                }
            }

            if (simulationState === 'RESTARTING') {
                time = 0;
                restartSimulation();
            }

            draw();
        }

        // Start the animation
        animate();
    </script>
</body>
</html>